<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مانغا الغراب - موقع رسمي</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700&family=Roboto:wght@300;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(45deg, #667eea, #764ba2);
            --dark-bg: linear-gradient(-45deg, #1a1a2e, #16213e, #0f3460, #1e3a5f);
        }
        * { box-sizing: border-box; }
        body { 
            font-family: 'Noto Sans Arabic', sans-serif; 
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab); 
            background-size: 400% 400%; 
            animation: gradientShift 15s ease infinite; 
            color: #333; 
            margin: 0; 
            padding: 0; 
            line-height: 1.6; 
            overflow-x: hidden;
            direction: rtl;
            transition: all 0.3s ease;
        }
        body.dark-mode {
            background: var(--dark-bg);
            color: #ddd;
        }
        body[dir="ltr"] { 
            direction: ltr; 
            text-align: left; 
            font-family: 'Roboto', sans-serif; 
        }
        @keyframes gradientShift { 
            0%{background-position:0% 50%} 
            50%{background-position:100% 50%} 
            100%{background-position:0% 50%} 
        }

        /* === الشريط الجانبي === */
        .sidebar {
            position: fixed;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 999;
        }
        .sidebar-btn {
            width: 50px; height: 50px;
            border-radius: 50%;
            background: rgba(255,255,255,0.9);
            border: none;
            font-size: 1.4em;
            color: #333;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .sidebar-btn:hover { transform: scale(1.15); }
        .dark-mode .sidebar-btn { background: rgba(30,30,30,0.9); color: #fff; }

        /* === Google Translate === */
        #google_translate_element {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 998;
        }
        .goog-te-gadget { font-size: 0 !important; }
        .goog-te-gadget select { 
            background: rgba(255,255,255,0.9); 
            border: none; 
            padding: 8px 12px; 
            border-radius: 20px; 
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* === لوحة الإدارة === */
        #admin-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            overflow-y: auto;
            padding: 20px;
        }
        #admin-content {
            background: rgba(255,255,255,0.95);
            margin: 5% auto;
            padding: 30px;
            border-radius: 12px;
            max-width: 900px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .admin-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .admin-section h3 { margin-top: 0; }
        .admin-section input, .admin-section textarea, .admin-section button {
            margin: 8px 0;
            padding: 10px;
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .admin-section button {
            background: #667eea;
            color: white;
            cursor: pointer;
        }
        .delete-btn { background: #e53e3e !important; }
        .close-admin { float: left; font-size: 28px; cursor: pointer; }

        /* === باقي التصميم === */
        header, .description, .chapters, .chapter, .read-btn, #comments, footer { /* نفس التصميم السابق */ }
        .dark-mode .description, .dark-mode .chapter, .dark-mode #comments, .dark-mode footer, .dark-mode #admin-content {
            background: rgba(30,30,30,0.95) !important;
            color: #eee;
        }

        /* === تحسينات للهاتف === */
        @media (max-width: 768px) {
            .sidebar { flex-direction: row; bottom: 15px; top: auto; left: 50%; transform: translateX(-50%); background: rgba(255,255,255,0.9); padding: 10px; border-radius: 50px; }
            .dark-mode .sidebar { background: rgba(30,30,30,0.9); }
            h1 { font-size: 2.2em; }
            .cover { max-width: 300px; }
            .chapters { flex-direction: column; align-items: center; }
            .chapter { width: 90%; max-width: 300px; }
            #admin-content { margin: 10% auto; padding: 20px; }
        }
    </style>
</head>
<body>

    <!-- الشريط الجانبي -->
    <div class="sidebar">
        <button class="sidebar-btn" id="dark-mode-btn" title="الوضع الليلي"><i class="fas fa-moon"></i></button>
        <button class="sidebar-btn" id="notification-btn" title="الإشعارات"><i class="fas fa-bell"></i></button>
        <button class="sidebar-btn" id="admin-panel-btn" title="لوحة تحكم الكاتب"><i class="fas fa-cog"></i></button>
    </div>

    <!-- Google Translate -->
    <div id="google_translate_element"></div>

    <!-- لوحة الإدارة -->
    <div id="admin-modal">
        <div id="admin-content">
            <span class="close-admin" onclick="closeAdmin()">&times;</span>
            <h2>لوحة تحكم الكاتب</h2>

            <!-- رفع الغلاف -->
            <div class="admin-section">
                <h3>تغيير غلاف الموقع</h3>
                <input type="file" id="cover-upload" accept="image/*">
                <button onclick="updateCover()">تحديث الغلاف</button>
            </div>

            <!-- تعديل الوصف -->
            <div class="admin-section">
                <h3>تعديل وصف القصة</h3>
                <textarea id="edit-desc" rows="3" placeholder="وصف القصة..."></textarea>
                <button onclick="updateDescription()">حفظ الوصف</button>
            </div>

            <!-- إضافة شخصية -->
            <div class="admin-section">
                <h3>إضافة شخصية</h3>
                <input type="text" id="char-name" placeholder="اسم الشخصية">
                <input type="text" id="char-desc" placeholder="وصف الشخصية">
                <button onclick="addCharacter()">إضافة</button>
                <ul id="admin-characters"></ul>
            </div>

            <!-- إضافة فصل -->
            <div class="admin-section">
                <h3>إضافة فصل جديد</h3>
                <input type="text" id="chapter-title" placeholder="عنوان الفصل">
                <textarea id="chapter-desc" rows="2" placeholder="وصف مختصر"></textarea>
                <input type="file" id="chapter-preview" accept="image/*" placeholder="غلاف الفصل">
                <input type="file" id="chapter-file" accept=".zip,.pdf,.cbz,.cbr">
                <button onclick="addChapter()">إضافة الفصل</button>
                <ul id="admin-chapters"></ul>
            </div>

            <button onclick="exportData()" style="background:#28a745;">تصدير البيانات (JSON)</button>
        </div>
    </div>

    <!-- باقي المحتوى -->
    <header>
        <h1><i class="fas fa-book-open"></i> مانغا الغراب</h1>
        <img id="cover-img" src="images/cover.jpg" alt="غلاف" class="cover">
    </header>

    <section class="description" id="description-section">
        <h2><i class="fas fa-info-circle"></i> وصف القصة</h2>
        <p id="story-desc">جاري التحميل...</p>
        <h3><i class="fas fa-users"></i> الشخصيات</h3>
        <ul id="characters-list"></ul>
        <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
        <p id="progress-text" style="text-align:center;font-style:italic;">جاري التحميل...</p>
    </section>

    <section class="chapters" id="chapters-section"></section>

    <section id="comments">
        <h2><i class="fas fa-comments"></i> اترك تعليقك</h2>
        <form id="comment-form">
            <input type="text" id="name" placeholder="اسمك" required maxlength="50">
            <textarea id="message" rows="4" placeholder="تعليقك..." required maxlength="500"></textarea>
            <button type="submit" id="submit-btn"><i class="fas fa-paper-plane"></i> أرسل</button>
        </form>
        <div id="comments-list"></div>
    </section>

    <footer>
        <div class="social-links">
            <a href="https://www.facebook.com/profile.php?id=61557602322000" target="_blank"><i class="fab fa-facebook"></i></a>
            <a href="https://www.instagram.com/the_crow_000" target="_blank"><i class="fab fa-instagram"></i></a>
        </div>
        <p>© 2025 عبد الدين بلال. جميع الحقوق محفوظة.</p>
    </footer>

    <!-- Modal الفصل -->
    <div id="chapter-modal">
        <span class="close" onclick="closeChapterModal()">&times;</span>
        <div id="chapter-content"></div>
    </div>

    <!-- Firebase + المنطق -->
    <script>
        // استبدل بإعدادات مشروعك
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        const ADMIN_PASSWORD = 'Bilal.abdedine';
        let mangaData = {};

        // فتح لوحة الإدارة
        document.getElementById('admin-panel-btn').onclick = () => {
            const pass = prompt("كلمة المرور:");
            if (pass === ADMIN_PASSWORD) {
                document.getElementById('admin-modal').style.display = 'block';
                loadAdminData();
            } else if (pass !== null) {
                alert("كلمة المرور خاطئة!");
            }
        };

        function closeAdmin() {
            document.getElementById('admin-modal').style.display = 'none';
        }

        // تحديث الغلاف
        async function updateCover() {
            const file = document.getElementById('cover-upload').files[0];
            if (!file) return alert("اختر صورة!");
            const ref = storage.ref('cover/' + file.name);
            await ref.put(file);
            const url = await ref.getDownloadURL();
            await db.collection('manga').doc('data').update({ cover: url });
            loadData();
        }

        // تحديث الوصف
        async function updateDescription() {
            const desc = document.getElementById('edit-desc').value.trim();
            if (!desc) return alert("اكتب وصفًا!");
            await db.collection('manga').doc('data').update({ 'description.ar': desc });
            loadData();
        }

        // إضافة شخصية
        async function addCharacter() {
            const name = document.getElementById('char-name').value.trim();
            const desc = document.getElementById('char-desc').value.trim();
            if (!name || !desc) return alert("املأ الحقول!");
            const doc = await db.collection('manga').doc('data').get();
            const data = doc.data();
            data.characters = data.characters || [];
            data.characters.push({ name, desc });
            await db.collection('manga').doc('data').set(data);
            loadAdminData();
            document.getElementById('char-name').value = '';
            document.getElementById('char-desc').value = '';
        }

        // إضافة فصل
        async function addChapter() {
            const title = document.getElementById('chapter-title').value.trim();
            const desc = document.getElementById('chapter-desc').value.trim();
            const preview = document.getElementById('chapter-preview').files[0];
            const file = document.getElementById('chapter-file').files[0];
            if (!title || !desc || !preview || !file) return alert("املأ كل الحقول!");

            const previewRef = storage.ref('previews/' + preview.name);
            await previewRef.put(preview);
            const previewUrl = await previewRef.getDownloadURL();

            const fileRef = storage.ref('chapters/' + file.name);
            await fileRef.put(file);
            const fileUrl = await fileRef.getDownloadURL();

            const doc = await db.collection('manga').doc('data').get();
            const data = doc.data();
            data.chapters = data.chapters || [];
            data.chapters.push({ title, desc, preview: previewUrl, fileUrl, views: 0 });
            await db.collection('manga').doc('data').set(data);
            loadData();
            loadAdminData();
            alert("تم إضافة الفصل!");
        }

        // تحميل لوحة الإدارة
        async function loadAdminData() {
            const doc = await db.collection('manga').doc('data').get();
            const data = doc.data();
            document.getElementById('edit-desc').value = data.description?.ar || '';

            document.getElementById('admin-characters').innerHTML = (data.characters || []).map((c, i) => `
                <li>${c.name} - ${c.desc} <button class="delete-btn" onclick="deleteCharacter(${i})">حذف</button></li>
            `).join('');

            document.getElementById('admin-chapters').innerHTML = (data.chapters || []).map((ch, i) => `
                <li>${ch.title} <button class="delete-btn" onclick="deleteChapter(${i})">حذف</button></li>
            `).join('');
        }

        async function deleteCharacter(i) {
            if (!confirm("هل تريد الحذف؟")) return;
            const doc = await db.collection('manga').doc('data').get();
            const data = doc.data();
            data.characters.splice(i, 1);
            await db.collection('manga').doc('data').set(data);
            loadAdminData();
        }

        async function deleteChapter(i) {
            if (!confirm("هل تريد الحذف؟")) return;
            const doc = await db.collection('manga').doc('data').get();
            const data = doc.data();
            data.chapters.splice(i, 1);
            await db.collection('manga').doc('data').set(data);
            loadData();
            loadAdminData();
        }

        function exportData() {
            db.collection('manga').doc('data').get().then(doc => {
                const data = JSON.stringify(doc.data(), null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = 'manga-data.json'; a.click();
            });
        }

        // باقي الدوال (loadData, readChapter, Dark Mode, إلخ) كما هي
        // ... (نفس الكود السابق لتحميل البيانات وقراءة الفصل)

        window.onload = () => {
            loadData();
            displayComments();
        };
    </script>
</body>
</html>
